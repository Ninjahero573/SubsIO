# JukeboxLED (Subsio)

A web-controlled local music jukebox with LED lightshow support, YouTube search/download, and optional Arduino integration.

## Quick overview
- Play and queue audio via a browser UI.
- Search/download audio using `yt-dlp`.
- Optional Google OAuth integration to browse your YouTube playlists.
- Real-time UI updates via Socket.IO (now-playing, progress, queue).
- Audio analysis drives LED lightshows; includes helpers to upload to Arduino devices.

## Requirements
- Python 3.11 or newer
- System packages for audio processing (FFmpeg, libsndfile recommended)
- Windows: run PowerShell as Administrator if you plan to bind to port 80

Dependencies are listed in `requirements.txt`.

## Quickstart (Windows PowerShell)
1. Create and activate a virtual environment:

```powershell
python -m venv .venv
& .\.venv\Scripts\Activate.ps1
```

2. Install Python requirements:

```powershell
pip install -r requirements.txt
```

3. (Optional) Set environment variables for Google OAuth and token encryption:

```powershell
$env:GOOGLE_OAUTH_CLIENT_ID = 'your-client-id'
$env:GOOGLE_OAUTH_CLIENT_SECRET = 'your-client-secret'
# Optional: set a Fernet key or passphrase to protect OAuth tokens
$env:OAUTH_ENC_KEY = 'base64-or-passphrase'
```

If `OAUTH_ENC_KEY` is not provided, a local `.oauth_key` will be created inside the `auth/` folder (developer convenience only).

4. Run the app (default binds to port 80):

```powershell
# From the project root
python app.py
```

If you prefer to run on an unprivileged port (e.g., 5000), update `config.py` `PORT` to `5000` before starting.

Open a browser to `http://localhost:5000` (or `http://<host>:<port>`).

## Configuration
- `config.py` contains the primary configuration (host, port, LED strips, audio sampling settings, download directory, etc.).
- OAuth defaults and `OAUTH_REDIRECT_URI` are also in `config.py`; if you use Google OAuth, register a Web Application client in Google Cloud Console and set the redirect URI to match.
- `auth/token_store.py` uses `OAUTH_ENC_KEY` (or `.oauth_key`) to encrypt stored OAuth credentials.

## Important env vars
- `GOOGLE_OAUTH_CLIENT_ID` and `GOOGLE_OAUTH_CLIENT_SECRET` — required for YouTube OAuth features.
- `OAUTH_ENC_KEY` — Fernet key or passphrase to encrypt OAuth tokens (recommended for production).
- `OAUTH_TOKEN_DB` — optional path to token DB (defaults to `auth/auth_tokens.db`).

## Project layout (key files)
- `app.py` — launcher that starts background workers and the Flask+SocketIO server.
- `server/` — Flask app package: HTTP routes, Socket.IO handlers, and app bootstrap.
- `static/`, `templates/` — frontend assets and Jinja templates.
- `auth/` — token storage utilities (`token_store.py`).
- `playback_worker.py`, `queue_manager.py` — queue processing and playback logic.
- `audio_analyzer.py` and `light_show_generator.py` — generate LED lightshow frames from audio.
- `arduino/` — helper scripts and firmware/upload utilities for Arduino devices.
- `downloads/` — stored downloaded audio files.
- `lightshows/` — generated lightshow data.

## Notes & troubleshooting
- If you see OAuth errors mentioning `insecure_transport`, that usually means OAuth attempted over HTTP; for local development the app can be configured to allow that, but for production use HTTPS and register an HTTPS redirect URI in Google Cloud Console.
- If you bind to port 80 on Windows you may need Administrator privileges or change `config.py` PORT to an unprivileged port.
- Ensure `ffmpeg` is installed and on your PATH for media processing.

## Development & Contribution
- Run `python app.py` to start the server with background workers.
- Frontend files live in `static/` and `templates/` — edit and refresh to see UI changes.
- Tests and a simple `test_setup.py` helper exist for basic sanity checks.

If you'd like, I can also:
- Add example environment variable files (`.env`) and a `Makefile`/PowerShell script for common tasks.
- Generate a minimal `README` badge and license file.

---
Generated by assistant to help onboard development and usage. Update any sections to match your deployment choices.
